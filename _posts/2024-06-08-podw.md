---
layout: post
title: post test 22
date: 2024-05-27 17:18 +0900
last_modified_at: 2024-05-27 17:18 +0900
tags: [API]
---
# Open API wrapper 개발 중간 후기

### 왜 네오플로 함?

타 Open API 대비 자세한 정보를 확인할 수 있고 허용량이 좋다

### 지금 까지 발생한 문제

1. 관계형 데이터베이스의 한계
1차 가공된 데이터를 wrapper가 반환하도록 했고 이를 바로 RDB에 저장하는 구조를 가지도록 설계했다. 하지만 예상하지 못하는 경우가 항상 발생한다. 또 API 리턴값의 구조가 바뀌면 코드를 수정하기 전 까지 작동하지 않는다.
이를 위한 해결책으로 반환하는 데이터를 어떠한 가공도 없이 일단 저장하고 이를 가공해서 저장하는 방식으로 바꾼다. 어떠한 가공도 없는 다양한 데이터를 저장해야 하니 RDB보다는 NoSQL이 적합해보인다.
2. 쿼리 복잡도와 정규화의 트레이드오프
RDB는 엄격해야하고 이를 위해 정규화 한다.
하지만 지금 데이터를 정규화 하면 분석을 위한 쿼리가 너무 복잡해진다.
그렇다면 분석을 위한 데이터 베이스를 따로 설정해야 할 필요가 있다
즉 데이터 베이스를 데이터 웨어하우스와 데이터 마트로 분리해서 사용할 필요가 있다
3. 코드 간소화와 가독성
최초의 코드는 가독성 위주로 반복이 있더라도 무시하고 사용
그러나 코드를 수정하기 너무 어려워짐
가독성을 조금 포기하는 것으로 결론을 지었으나 이는 계속 고민해야 하는 부분
4. 매일 과업이 있어야 한다.
나의 개발 스타일은 task를 해결하다가 발생하는 다른 task를 먼저 처리함 즉 task stack으로 운영중이였다. 이러면 신규 task의 추가로 인해 기존 task가 밀리고 결국 아무것도 처리 못하는 상황이 발생함
이를 극복하기 위해 task처리 방식을 queue로 바꿀 필요성이 있음
5. 브랜치의 필요성
Git Actions를 통해 main branch에 push 할 때마다 PYPI배포 하도록 설정
조그만한 수정 사항이나 문서화를 위해 코드를 건드리지 않는데도 버전을 하나씩 올려야 함
그렇다면 차라리 브랜치를 분리해서 테스트 후 사용
6. 테스트 코드의 필요성
최초 개발 당시의 생각 : 테스트 코드 만드는 시간에 메인 코드 짜는게 더 이득이다
지금 생각 : 테스트코드 이제와서 만들려니 너무 힘들고 갑갑하다 TDD 이제야 깨달아요
7. I/O Bound 는 비동기가 딱이야
최초에 request로 처리했음 요청 보내고 받을 때 까지 아무것도 할 수 없음
비동기로 처리하면 요청 보내고 다른 일을 할 수 있음 수집속도의 압도적 향상
8. 멀티 스레딩에서 공유하는 변수에 대한 쓰기 작업은 조심히
여러개의 API key를 가지고 있는 경우를 생각해서 멀티프로세싱 이용해서 진행
여러개의 스레드가 하나의 공유 변수에 쓰는 작업을 할 경우 찐빠가 날 수 있음

### 지금부터 해볼것

1. DL, DW, DM 구축
원시 데이터 저장소로 DL사용
데이터 웨어하우스와 데이터 마트 구축해보자
스키마 설계가 핵심 작업이 될것
2. 데이터 파이프라인 구축
airflow를 사용해서 지속적으로 데이터 업데이트 할 수 있도록 해보자
3. 배포 환경 결정
도커를 할건지 데이터마트에서 주제별로 테이블을 만들어서 파일로 배포할건지 그냥 파이썬 라이브러리로 제공만 할것인지
4. 클라우드?
지금까지의 프로젝트는 온프레미스환경에서 실시 하지만 데이터가 매우 커지는 경우 어찌할것인가
답은 클라우드 하지만 요금이 두렵다
5. 분산처리 시스템
데이터의 규모가 커지면 머신 여러대로 분산처리해야한다. spark를 사용해야 하는가